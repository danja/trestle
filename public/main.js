const e="http://purl.org/dc/terms/",t="http://purl.org/stuff/trestle/";const s={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"];class i{constructor(e,t,s){this.endpoint=e,this.baseUri=t,this.eventBus=s,this.rootId=null,this.nodes=new Map,this.eventBus.subscribe("node:updated",this.handleNodeUpdate.bind(this)),this.eventBus.subscribe("node:moved",this.handleNodeMove.bind(this)),this.eventBus.subscribe("node:deleted",this.handleNodeDelete.bind(this))}async initialize(){try{await this.loadData(),this.eventBus.publish("model:loaded",{nodes:Array.from(this.nodes.values())})}catch(e){console.error("Failed to initialize model:",e),this.createEmptyModel()}}createEmptyModel(){const e=this.generateNodeId("root");this.rootId=e,this.nodes.set(e,{id:e,type:"RootNode",children:[]}),this.eventBus.publish("model:created",{rootId:this.rootId,nodes:Array.from(this.nodes.values())})}generateNodeId(e="nid"){return`${e}-${function(){const e=function(e,t,i=!0){const o=(e,t)=>{for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e};if(1!==arguments.length||"[object String]"!==Object.prototype.toString.call(e)||/\d/.test(e)||(t=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");"UTC:"===(t=String(s[t]||t||s.default)).slice(0,4)&&(t=t.slice(4),i=!0);const r=i?"getUTC":"get",a=e[r+"Date"](),l=e[r+"Day"](),c=e[r+"Month"](),h=e[r+"FullYear"](),u=e[r+"Hours"](),p=e[r+"Minutes"](),m=e[r+"Seconds"](),g=e[r+"Milliseconds"](),y=i?0:e.getTimezoneOffset(),v={d:a,dd:o(a),ddd:n[l],dddd:n[l+7],m:c+1,mm:o(c+1),mmm:d[c],mmmm:d[c+12],yy:String(h).slice(2),yyyy:h,h:u%12||12,hh:o(u%12||12),H:u,HH:o(u),M:p,MM:o(p),s:m,ss:o(m),l:o(g,3),L:o(g>99?Math.round(g/10):g),t:u<12?"a":"p",tt:u<12?"am":"pm",T:u<12?"A":"P",TT:u<12?"AM":"PM",Z:i?"UTC":(String(e).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),o:(y>0?"-":"+")+o(100*Math.floor(Math.abs(y)/60)+Math.abs(y)%60,4),S:["th","st","nd","rd"][a%10>3?0:(a%100-a%10!=10)*a%10]};return t.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,(function(e){return e in v?v[e]:e.slice(1,e.length-1)}))}(new Date,"yyyy-mm-dd-HH-MM-ss-l");return`${e}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`}()}`}async loadData(){try{const e=`${this.endpoint}?query=${encodeURIComponent(this.buildLoadQuery())}`;console.log(`fURL = ${decodeURI(e)}`);const t=await fetch(e,{method:"GET",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`SPARQL query failed: ${t.statusText}`);const s=await t.json();return console.log(`data = ${JSON.stringify(s)}`),this.processLoadedData(s),!0}catch(e){throw console.error("Error loading data:",e),e}}buildLoadQuery(){return`\n            PREFIX dc: <${e}>\n            PREFIX ts: <${t}>\n\n            SELECT ?node ?type ?title ?created ?index ?parent WHERE {\n                ?node a ?type .\n                OPTIONAL { ?node dc:title ?title } .\n                OPTIONAL { ?node dc:created ?created } .\n                OPTIONAL { ?node ts:index ?index } .\n                OPTIONAL { ?node ts:parent ?parent } .\n             #   FILTER(STRSTARTS(STR(?type), "${t}"))\n            }\n        `}processLoadedData(e){this.nodes.clear(),this.rootId=null;const t=new Map;for(const s of e.results.bindings){const e=s.node.value,n=this.extractLocalId(e),d=this.extractLocalType(s.type.value);let i=t.get(n)||{id:n,children:[]};i.type=d,s.title&&(i.title=s.title.value),s.created&&(i.created=s.created.value),s.index&&(i.index=parseInt(s.index.value,10)),s.parent&&(i.parent=this.extractLocalId(s.parent.value)),"RootNode"===d&&(this.rootId=n),t.set(n,i)}for(const[e,s]of t.entries())if(s.parent){const n=t.get(s.parent);n&&(n.children||(n.children=[]),n.children.push(e))}for(const e of t.values())e.children&&e.children.length>0&&e.children.sort(((e,s)=>{const n=t.get(e),d=t.get(s);return(n.index||0)-(d.index||0)}));this.nodes=t}extractLocalId(e){const t=e.split("/");return t[t.length-1]}extractLocalType(e){const t=e.split("/");return t[t.length-1]}addNode(e,t,s){const n=this.generateNodeId(),d={id:n,type:"Node",title:t||"",created:(new Date).toISOString(),parent:e,index:s,children:[]};this.nodes.set(n,d);const i=this.nodes.get(e);return i&&(i.children||(i.children=[]),"number"==typeof s?(i.children.splice(s,0,n),this.updateChildIndices(i)):(d.index=i.children.length,i.children.push(n))),d}updateChildIndices(e){e.children&&e.children.forEach(((e,t)=>{const s=this.nodes.get(e);s&&(s.index=t)}))}moveNode(e,t,s){const n=this.nodes.get(e);if(!n)return;const d=n.parent,i=this.nodes.get(d);if(i&&i.children){const t=i.children.indexOf(e);-1!==t&&(i.children.splice(t,1),this.updateChildIndices(i))}const o=this.nodes.get(t);o&&(o.children||(o.children=[]),"number"==typeof s?o.children.splice(s,0,e):(o.children.push(e),s=o.children.length-1),n.parent=t,n.index=s,this.updateChildIndices(o))}deleteNode(e){const t=this.nodes.get(e);if(!t)return;if(t.children&&t.children.length>0){const e=[...t.children];for(const t of e)this.deleteNode(t)}const s=t.parent;if(s){const t=this.nodes.get(s);if(t&&t.children){const s=t.children.indexOf(e);-1!==s&&(t.children.splice(s,1),this.updateChildIndices(t))}}this.nodes.delete(e)}updateNode(e,t){const s=this.nodes.get(e);s&&Object.assign(s,t)}updateNodeDescription(e,t){const s=this.nodes.get(e);s&&(s.description=t)}getNode(e){return this.nodes.get(e)}getAllNodes(){return Array.from(this.nodes.values())}getRootNode(){return this.nodes.get(this.rootId)}toTurtle(){let s=`@prefix dc: <${e}> .\n`;s+=`@prefix ts: <${t}> .\n\n`;const n=this.nodes.get(this.rootId);n&&(s+=`<${this.baseUri}${n.id}> a ts:RootNode .\n`);for(const[e,t]of this.nodes.entries())e!==this.rootId&&"Node"===t.type&&(s+=`<${this.baseUri}${t.id}> a ts:Node;\n`,t.title&&(s+=`   dc:title "${this.escapeTurtle(t.title)}" ;\n`),t.created&&(s+=`   dc:created "${t.created}" ;\n`),s+=`   ts:index "${t.index}" ;\n`,t.parent?s+=`   ts:parent <${this.baseUri}${t.parent}> .\n`:s+=`   ts:parent <${this.baseUri}${this.rootId}> .\n`,t.description&&(s+=`<${this.baseUri}${t.id}> dc:description """${this.escapeTurtle(t.description)}""" .\n`));return s}escapeTurtle(e){return e?e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t"):""}async saveData(){try{const e=this.toTurtle(),t=await fetch(this.endpoint,{method:"PUT",headers:{"Content-Type":"text/turtle"},body:e});if(!t.ok)throw new Error(`Failed to save data: ${t.statusText}`);return!0}catch(e){return console.error("Error saving data:",e),this.eventBus.publish("model:error",{message:"Failed to save data",error:e}),!1}}handleNodeUpdate(e){const{nodeId:t,properties:s}=e;this.updateNode(t,s)}handleNodeMove(e){const{nodeId:t,newParentId:s,newIndex:n}=e;this.moveNode(t,s,n)}handleNodeDelete(e){const{nodeId:t}=e;this.deleteNode(t)}}class o{constructor(e,t){this.rootElement=e,this.eventBus=t,this.template=document.getElementById("entry-template"),this.nodeElements=new Map,this.selectedNodeId=null,this.draggedNodeId=null,this.dragTarget=null,this.eventBus.subscribe("model:loaded",this.renderTree.bind(this)),this.eventBus.subscribe("model:created",this.renderTree.bind(this)),this.eventBus.subscribe("node:added",this.handleNodeAdded.bind(this)),this.eventBus.subscribe("node:updated",this.handleNodeUpdated.bind(this)),this.eventBus.subscribe("node:deleted",this.handleNodeDeleted.bind(this))}renderTree(e){this.rootElement.innerHTML="",this.nodeElements.clear();const t=e.nodes.find((e=>"RootNode"===e.type));if(!t)return void console.error("No root node found");const s=this.buildTreeStructure(e.nodes,t.id),n=document.createElement("ul");n.className="ts-root",this.rootElement.appendChild(n);for(const e of s.children||[])this.renderNode(e,n,s.nodes);this.setupEventListeners(),this.initDragAndDrop()}buildTreeStructure(e,t){const s=new Map;for(const t of e)s.set(t.id,{...t});for(const e of s.values())e.children?e.children=e.children.filter((e=>s.has(e))):e.children=[];return{rootId:t,nodes:s}}renderNode(e,t,s){const n=s.get(e);if(!n)return null;const d=document.createElement("li");d.dataset.nodeId=e;const i=document.createElement("div");i.className="dropzone",d.appendChild(i);const o=this.template.content.cloneNode(!0).querySelector(".ts-entry");if(o.id=e,o.querySelector(".ts-title").textContent=n.title||"",o.querySelector(".date").textContent=n.created||"",d.appendChild(o),this.nodeElements.set(e,d),n.children&&n.children.length>0){const e=document.createElement("ul");d.appendChild(e),d.classList.add("ts-open");for(const t of n.children)this.renderNode(t,e,s)}else d.classList.add("ts-closed");return t.appendChild(d),d}setupEventListeners(){this.rootElement.addEventListener("click",this.handleClick.bind(this)),this.rootElement.addEventListener("dblclick",this.handleDblClick.bind(this)),this.rootElement.addEventListener("keydown",this.handleKeyDown.bind(this)),this.rootElement.addEventListener("focus",this.handleFocus.bind(this),!0),this.rootElement.addEventListener("blur",this.handleBlur.bind(this),!0)}handleClick(e){const t=e.target;if(t.classList.contains("ts-expander")){const s=t.closest("li");return s.classList.toggle("ts-closed"),s.classList.toggle("ts-open"),void e.stopPropagation()}if(t.classList.contains("ts-card"))return this.showCard(t.closest(".ts-entry").id),void e.stopPropagation();if(t.classList.contains("ts-addChild")){const s=t.closest(".ts-entry").id;return this.eventBus.publish("view:addChild",{parentId:s}),void e.stopPropagation()}if(t.classList.contains("ts-delete")){const s=t.closest(".ts-entry").id;return confirm("Are you sure you want to delete this item and all its children?")&&this.eventBus.publish("view:deleteNode",{nodeId:s}),void e.stopPropagation()}if(t.classList.contains("ts-entry")||t.classList.contains("ts-title")){const s=t.classList.contains("ts-entry")?t:t.closest(".ts-entry");return this.selectNode(s.id),void e.stopPropagation()}}handleDblClick(e){const t=e.target;if(t.classList.contains("ts-title")){t.contentEditable=!0,t.focus();const s=document.createRange();s.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(s),e.stopPropagation()}}handleKeyDown(e){if(!e.target.isContentEditable)return;const t=e.target.closest(".ts-entry");if(t)switch(e.key){case"Enter":if(!e.shiftKey){e.preventDefault(),e.target.contentEditable=!1;const s=t.id,n=e.target.textContent.trim();this.eventBus.publish("view:updateNode",{nodeId:s,properties:{title:n}}),this.eventBus.publish("view:addSibling",{nodeId:s})}break;case"Tab":e.preventDefault(),e.shiftKey?this.eventBus.publish("view:outdentNode",{nodeId:t.id}):this.eventBus.publish("view:indentNode",{nodeId:t.id});break;case"Escape":e.preventDefault(),e.target.contentEditable=!0,this.selectNode(t.id);break;case"ArrowUp":e.preventDefault(),this.navigateUp(t.id);break;case"ArrowDown":e.preventDefault(),this.navigateDown(t.id)}}handleFocus(e){if(e.target.classList.contains("ts-title")){const t=e.target.closest(".ts-entry");this.selectNode(t.id)}}handleBlur(e){if(e.target.classList.contains("ts-title")&&e.target.isContentEditable){const t=e.target.closest(".ts-entry").id,s=e.target.textContent.trim();this.eventBus.publish("view:updateNode",{nodeId:t,properties:{title:s}})}}initDragAndDrop(){this.rootElement.querySelectorAll(".ts-handle").forEach((e=>{e.addEventListener("mousedown",this.handleDragStart.bind(this)),e.setAttribute("draggable","true"),e.addEventListener("dragstart",this.handleDragStart.bind(this))})),this.rootElement.querySelectorAll(".dropzone").forEach((e=>{e.addEventListener("dragover",this.handleDragOver.bind(this)),e.addEventListener("dragleave",this.handleDragLeave.bind(this)),e.addEventListener("drop",this.handleDrop.bind(this))})),this.rootElement.querySelectorAll("li").forEach((e=>{e.addEventListener("dragenter",this.handleDragEnter.bind(this))}))}handleDragStart(e){const t=e.target.closest(".ts-entry");if(t){if(this.draggedNodeId=t.id,e.dataTransfer){e.dataTransfer.setData("text/plain",t.id),e.dataTransfer.effectAllowed="move";const s=t.cloneNode(!0);s.style.width=`${t.offsetWidth}px`,s.style.opacity="0.7",document.body.appendChild(s),e.dataTransfer.setDragImage(s,10,10),setTimeout((()=>{document.body.removeChild(s)}),0)}t.classList.add("ts-dragging"),this.selectNode(t.id)}}handleDragOver(e){e.preventDefault(),this.draggedNodeId&&(e.target.classList.add("active"),e.dataTransfer.dropEffect="move")}handleDragLeave(e){e.target.classList.remove("active")}handleDragEnter(e){const t=e.target.closest("li");t&&this.draggedNodeId&&(this.dragTarget=t,t.classList.add("ts-highlight"),this.dragEnterTimer&&clearTimeout(this.dragEnterTimer),this.dragEnterTimer=setTimeout((()=>{t.classList.contains("ts-closed")&&(t.classList.remove("ts-closed"),t.classList.add("ts-open"))}),700))}handleDrop(e){e.preventDefault();const t=e.target;if(t.classList.remove("active"),!this.draggedNodeId)return;const s=this.nodeElements.get(this.draggedNodeId);if(!s)return;const n=t.closest("li");if(!n)return;if(s.contains(n))return void console.warn("Cannot drop onto a child element");const d=n.parentElement;let i,o;if(t===n.querySelector(".dropzone"))i=n.parentElement.closest("li")?.dataset.nodeId||"trestle-root",o=Array.from(d.children).indexOf(n);else{i=n.dataset.nodeId;let e=n.querySelector("ul");e||(e=document.createElement("ul"),n.appendChild(e),n.classList.remove("ts-closed"),n.classList.add("ts-open")),o=e.children.length}this.eventBus.publish("view:moveNode",{nodeId:this.draggedNodeId,newParentId:i,newIndex:o}),this.draggedNodeId=null,s.classList.remove("ts-dragging"),document.querySelectorAll(".ts-highlight").forEach((e=>{e.classList.remove("ts-highlight")}))}selectNode(e){if(this.selectedNodeId){const e=document.getElementById(this.selectedNodeId);e&&(e.classList.remove("ts-selected"),e.querySelector(".ts-title"))}this.selectedNodeId=e;const t=document.getElementById(e);t&&t.classList.add("ts-selected")}navigateUp(e){const t=this.nodeElements.get(e);if(!t)return;let s=t.previousElementSibling;if(s){for(;s.classList.contains("ts-open")&&s.querySelector("ul")?.lastElementChild;)s=s.querySelector("ul").lastElementChild;const e=s.querySelector(".ts-entry").id;this.selectNode(e)}else{const e=t.parentElement.closest("li");if(e){const t=e.querySelector(".ts-entry").id;this.selectNode(t)}}}navigateDown(e){const t=this.nodeElements.get(e);if(!t)return;if(t.classList.contains("ts-open")){const e=t.querySelector("ul > li");if(e){const t=e.querySelector(".ts-entry").id;return void this.selectNode(t)}}let s=t.nextElementSibling;if(s){const e=s.querySelector(".ts-entry").id;return void this.selectNode(e)}let n=t.parentElement.closest("li");for(;n;){const e=n.nextElementSibling;if(e){const t=e.querySelector(".ts-entry").id;return void this.selectNode(t)}n=n.parentElement.closest("li")}}showCard(e){const t=document.getElementById(e);if(!t)return;const s=t.querySelector(".ts-title").textContent,n=t.querySelector(".date").textContent;this.eventBus.publish("view:getNodeData",{nodeId:e,callback:t=>{const d=document.getElementById("card"),i=document.getElementById("card-title"),o=document.getElementById("card-nid"),r=document.getElementById("card-date"),a=document.getElementById("card-description");i.textContent=s,o.textContent=e,r.textContent=n,a.value=t.description||"",d.dataset.nodeId=e,d.classList.remove("hidden"),a.focus()}})}handleNodeAdded(e){const{node:t,parentId:s}=e;let n;if("trestle-root"===s)n=this.rootElement.querySelector("ul");else{const e=this.nodeElements.get(s);if(!e)return void console.error("Parent not found:",s);let t=e.querySelector("ul");t||(t=document.createElement("ul"),e.appendChild(t),e.classList.remove("ts-closed"),e.classList.add("ts-open")),n=t}const d=new Map;d.set(t.id,t);const i=this.renderNode(t.id,n,d);if(i){const e=i.querySelector(".ts-title");this.selectNode(t.id),e.contentEditable=!0,e.focus();const s=document.createRange();s.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(s)}this.initDragAndDrop()}handleNodeUpdated(e){const{nodeId:t,properties:s}=e,n=document.getElementById(t);n&&void 0!==s.title&&(n.querySelector(".ts-title").textContent=s.title)}handleNodeDeleted(e){const{nodeId:t}=e,s=this.nodeElements.get(t);s&&(s.remove(),this.nodeElements.delete(t))}}class r{constructor(e,t,s){this.model=e,this.view=t,this.eventBus=s,this.setupEventHandlers()}initialize(){this.model.initialize()}setupEventHandlers(){this.eventBus.subscribe("view:addChild",this.handleAddChild.bind(this)),this.eventBus.subscribe("view:addSibling",this.handleAddSibling.bind(this)),this.eventBus.subscribe("view:updateNode",this.handleUpdateNode.bind(this)),this.eventBus.subscribe("view:deleteNode",this.handleDeleteNode.bind(this)),this.eventBus.subscribe("view:moveNode",this.handleMoveNode.bind(this)),this.eventBus.subscribe("view:indentNode",this.handleIndentNode.bind(this)),this.eventBus.subscribe("view:outdentNode",this.handleOutdentNode.bind(this)),this.eventBus.subscribe("view:getNodeData",this.handleGetNodeData.bind(this))}async saveData(){await this.model.saveData()?alert("Data saved successfully"):alert("Failed to save data")}addRootItem(){const e=this.model.getRootNode();if(!e)return;const t=this.model.addNode(e.id,"",e.children.length);this.eventBus.publish("node:added",{node:t,parentId:"trestle-root"})}updateNodeDescription(e,t){this.model.updateNodeDescription(e,t)}handleAddChild(e){const{parentId:t}=e,s=this.model.getNode(t);if(!s)return;const n=s.children?s.children.length:0,d=this.model.addNode(t,"",n);this.eventBus.publish("node:added",{node:d,parentId:t})}handleAddSibling(e){const{nodeId:t}=e,s=this.model.getNode(t);if(!s)return;const n=s.parent,d=this.model.getNode(n);if(!d)return;const i=d.children.indexOf(t);if(-1===i)return;const o=this.model.addNode(n,"",i+1);this.eventBus.publish("node:added",{node:o,parentId:n})}handleUpdateNode(e){const{nodeId:t,properties:s}=e;this.model.updateNode(t,s),this.eventBus.publish("node:updated",{nodeId:t,properties:s})}handleDeleteNode(e){const{nodeId:t}=e;this.model.deleteNode(t),this.eventBus.publish("node:deleted",{nodeId:t})}handleMoveNode(e){const{nodeId:t,newParentId:s,newIndex:n}=e;this.model.moveNode(t,s,n)}handleIndentNode(e){const{nodeId:t}=e,s=this.model.getNode(t);if(!s||!s.parent)return;const n=this.model.getNode(s.parent);if(!n||!n.children)return;const d=n.children.indexOf(t);if(d<=0)return;const i=n.children[d-1],o=this.model.getNode(i);o&&(this.model.moveNode(t,i,o.children?o.children.length:0),this.eventBus.publish("view:nodeIndented",{nodeId:t,newParentId:i}))}handleOutdentNode(e){const{nodeId:t}=e,s=this.model.getNode(t);if(!s||!s.parent)return;const n=this.model.getNode(s.parent);if(!n||!n.parent)return;const d=n.parent,i=this.model.getNode(d);if(!i)return;const o=i.children.indexOf(n.id);-1!==o&&(this.model.moveNode(t,d,o+1),this.eventBus.publish("view:nodeOutdented",{nodeId:t,newParentId:d}))}handleGetNodeData(e){const{nodeId:t,callback:s}=e,n=this.model.getNode(t);n&&s&&s(n)}}class a{constructor(){this.subscribers=new Map}subscribe(e,t){this.subscribers.has(e)||this.subscribers.set(e,[]);const s=this.subscribers.get(e);return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)}}publish(e,t={}){this.subscribers.has(e)&&this.subscribers.get(e).forEach((s=>{try{s(t)}catch(t){console.error(`Error in event handler for ${e}:`,t)}}))}unsubscribeAll(e){e?this.subscribers.delete(e):this.subscribers.clear()}}document.addEventListener("DOMContentLoaded",(()=>{const e=new a,t=new i("https://fuseki.hyperdata.it/farelo","http://hyperdata.it/trestle/",e),s=new o(document.getElementById("trestle-root"),e),n=new r(t,s,e);!function(e){const t=document.getElementById("saveButton"),s=document.getElementById("addButton"),n=document.getElementById("shortcutsButton"),d=document.getElementById("card-close"),i=document.getElementById("shortcuts-text");t.addEventListener("click",(()=>e.saveData())),s.addEventListener("click",(()=>e.addRootItem())),n.addEventListener("click",(()=>{i.classList.toggle("hidden")})),d.addEventListener("click",(()=>{const t=document.getElementById("card"),s=document.getElementById("card-description");t.dataset.nodeId&&e.updateNodeDescription(t.dataset.nodeId,s.value),t.classList.add("hidden")}))}(n),n.initialize()}));